#!/bin/bash
#this install script will clone exploit-db official repository on ./exploits
#it will run `php update-db.php` command to sinchronize files with db
git=$(which  git);
php=$(which  php);
exploit_dir=./exploits;
gitremote="https://github.com/offensive-security/exploit-database.git"


function install()
{
     ## creating or going to correct folder
  mkdir -p "$exploit_dir/"
  cd "$exploit_dir/"
  
  ## parsing  
  if [[ "$( ${git} rev-parse --is-inside-work-tree )" != "true" ]]; then
    if [[ "$( ls )" = "" ]]; then
      # nothing here clonning
      echo -e '\nGood ! nothing here ! Clonning Exploit-db Repository .....\n';
      ${git} clone "${gitremote}" .
    fi
  fi
  
  # ok adding
  if [[ "$( ${git} remote -v )" != *"${gitremote}"* ]]; then
    echo 'adding remote repo' "${gitremote}"
    git init >/dev/null
    git remote add origin "${gitremote}" 2>/dev/null
  fi
  
  # Make sure to prep checkout first
  git checkout -- .
  
  # Update from git
  git pull origin master
  
  # If conflicts, clean and try again
  if [[ "$?" -ne 0 ]]; then
    git clean -d -fx ""
    git pull origin master
  fi
  
  echo -e "Ok ! all installed"
  exit 6
}

install;    









